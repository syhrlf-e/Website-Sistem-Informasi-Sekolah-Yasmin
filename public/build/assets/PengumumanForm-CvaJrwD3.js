import{q as j,S as R,r as n,o as A,s as N,i as c,k as v,l as t,j as P,e as u,t as b,g as S,m as d,u as f,B as V,O as E,U as L}from"./vendor-0BLfaBTW.js";import{a as O,c as I,d as Y}from"./app-F21Gw_vX.js";import{I as q}from"./ImageCropperModal-eOgvD4aF.js";import{A as J,g as K,ac as W,h as z,ai as H,ak as Q}from"./ui-BH4Jb6j-.js";const X={class:"space-y-6"},Z={class:"flex items-center justify-between"},ee={class:"text-2xl font-bold text-gray-900 dark:text-white font-poppins"},ae={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},te={key:0,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4"},re={class:"text-sm text-red-600 dark:text-red-400 font-poppins"},se={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700"},oe={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700"},ne={key:0,class:"mb-4"},le={class:"relative max-w-sm mx-auto group"},ie=["src"],ue={class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-3"},de={key:0,class:"absolute top-2 left-2 px-2 py-1 bg-green-500 text-white text-xs rounded-full font-medium flex items-center gap-1"},pe={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-3 text-center"},me={class:"flex items-center gap-4"},ge=["disabled"],ce={__name:"PengumumanForm",setup(ve){const k=j(),B=R(),{showSuccess:T}=Y(),l=n(!1),p=n(!1),i=n(null),x=n(null),y=n({width:0,height:0}),w=n(!1),_=n(""),m=n(""),g=n(null),s=n({title:"",image:null,remove_image:!1});A(()=>{k.params.id&&(l.value=!0,U(k.params.id))});const U=async r=>{try{p.value=!0;const e=await I.get(`/yasmin-panel/announcements/${r}`);if(e.data.success&&e.data.data){const a=e.data.data;s.value.title=a.title||"",a.image&&(x.value=a.image)}}catch{i.value="Gagal memuat data pengumuman"}finally{p.value=!1}},D=r=>{var o;const e=(o=r.target.files)==null?void 0:o[0];if(!e)return;if(!e.type.startsWith("image/")){i.value="Pilih file gambar yang valid!";return}if(e.size>2*1024*1024){i.value="Ukuran file maksimal 2MB";return}const a=new FileReader;a.onload=h=>{_.value=h.target.result,w.value=!0,i.value=null},a.readAsDataURL(e),r.target.value=""},G=r=>{g.value=r,m.value=URL.createObjectURL(r);const e=new Image;e.onload=()=>{y.value={width:e.width,height:e.height}},e.src=m.value},M=r=>{_.value=r},$=()=>{s.value.image=null,x.value=null,m.value="",g.value=null,y.value={width:0,height:0},l.value&&(s.value.remove_image=!0)},F=async()=>{var r,e;if(i.value=null,p.value=!0,!l.value&&!g.value&&!s.value.image){i.value="Gambar pengumuman wajib diupload",p.value=!1;return}try{const a=new FormData;a.append("title",s.value.title),a.append("is_active","1"),a.append("priority","0");const o=new Date,h=new Date(o);h.setFullYear(o.getFullYear()+1),a.append("start_date",o.toISOString().split("T")[0]),a.append("end_date",h.toISOString().split("T")[0]),g.value?a.append("image",g.value,"cropped-announcement.webp"):s.value.image&&a.append("image",s.value.image),s.value.remove_image&&a.append("remove_image","1");let C;l.value?(a.append("_method","PUT"),C=await I.post(`/yasmin-panel/announcements/${k.params.id}`,a,{headers:{"Content-Type":"multipart/form-data"}})):C=await I.post("/yasmin-panel/announcements",a,{headers:{"Content-Type":"multipart/form-data"}}),C.data.success&&(await T("Berhasil!",l.value?"Pengumuman berhasil diupdate!":"Pengumuman berhasil ditambahkan!"),B.push("/yasmin-panel/pengumuman"))}catch(a){console.error(a),i.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Terjadi kesalahan saat menyimpan"}finally{p.value=!1}};return(r,e)=>{const a=N("router-link");return v(),c("div",X,[t("div",Z,[t("div",null,[t("h1",ee,b(l.value?"Edit Pengumuman":"Tambah Pengumuman Baru"),1),t("p",ae,b(l.value?"Ganti gambar pengumuman":"Upload gambar untuk popup pengumuman"),1)]),u(a,{to:"/yasmin-panel/pengumuman",class:"flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors duration-200 font-poppins"},{default:S(()=>[u(f(J),{class:"w-4 h-4"}),e[4]||(e[4]=d(" Kembali ",-1))]),_:1})]),i.value?(v(),c("div",te,[t("p",re,b(i.value),1)])):P("",!0),t("form",{onSubmit:L(F,["prevent"]),class:"space-y-6"},[t("div",se,[e[5]||(e[5]=t("label",{class:"block text-sm font-semibold text-gray-900 dark:text-white mb-2 font-poppins"},[d(" Judul Pengumuman "),t("span",{class:"text-red-500"},"*")],-1)),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.title=o),type:"text",required:"",placeholder:"Contoh: Pendaftaran Siswa Baru 2025/2026",class:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white font-poppins"},null,512),[[E,s.value.title]])]),t("div",oe,[e[11]||(e[11]=t("label",{class:"block text-sm font-semibold text-gray-900 dark:text-white mb-4 font-poppins"},[d(" Gambar Pengumuman "),t("span",{class:"text-red-500"},"*")],-1)),m.value||x.value?(v(),c("div",ne,[t("div",le,[t("img",{src:m.value||x.value,alt:"Preview",class:"w-full rounded-xl border border-gray-200 dark:border-gray-700 shadow-lg"},null,8,ie),t("div",ue,[t("button",{type:"button",onClick:e[1]||(e[1]=o=>r.$refs.fileInput.click()),class:"px-4 py-2 bg-white/90 text-gray-900 rounded-lg font-medium text-sm flex items-center gap-2 hover:bg-white transition-colors"},[u(f(K),{class:"w-4 h-4"}),e[6]||(e[6]=d(" Ganti ",-1))]),t("button",{type:"button",onClick:$,class:"px-4 py-2 bg-red-500 text-white rounded-lg font-medium text-sm flex items-center gap-2 hover:bg-red-600 transition-colors"},[u(f(W),{class:"w-4 h-4"}),e[7]||(e[7]=d(" Hapus ",-1))])]),m.value?(v(),c("div",de,[u(f(z),{class:"w-3 h-3"}),e[8]||(e[8]=d(" Gambar dikrop ",-1))])):P("",!0)]),y.value.width?(v(),c("p",pe," Dimensi: "+b(y.value.width)+"x"+b(y.value.height)+"px ",1)):P("",!0)])):(v(),c("div",{key:1,class:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-12 text-center hover:border-blue-500 dark:hover:border-blue-400 transition-colors duration-200 cursor-pointer bg-gray-50 dark:bg-gray-900",onClick:e[2]||(e[2]=o=>r.$refs.fileInput.click())},[u(f(H),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[9]||(e[9]=t("p",{class:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2 font-poppins"}," Klik untuk upload gambar ",-1)),e[10]||(e[10]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," PNG, JPG, WEBP | Max 2MB | Akan di-crop otomatis ",-1))])),t("input",{ref:"fileInput",type:"file",accept:"image/*",class:"hidden",onChange:D},null,544)]),t("div",me,[t("button",{type:"submit",disabled:p.value||!l.value&&!g.value&&!s.value.image,class:"flex items-center gap-2 px-8 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-xl font-semibold transition-colors duration-200 shadow-lg hover:shadow-xl font-poppins"},[u(f(Q),{class:"w-5 h-5"}),d(" "+b(p.value?"Menyimpan...":l.value?"Update":"Simpan"),1)],8,ge),u(a,{to:"/yasmin-panel/pengumuman",class:"px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl font-semibold transition-colors duration-200 font-poppins"},{default:S(()=>[...e[12]||(e[12]=[d(" Batal ",-1)])]),_:1})])],32),u(q,{show:w.value,"image-src":_.value,"aspect-ratio":4/5,onClose:e[3]||(e[3]=o=>w.value=!1),onCrop:G,onChangeImage:M},null,8,["show","image-src"])])}}},he=O(ce,[["__scopeId","data-v-6f93eaa9"]]);export{he as default};
